@using AppData.Models;
@using AppData.FPhoneDbContexts;
@model List<BillDetails>


@{
    ViewData["Title"] = "Bill Detail";
    Layout = "~/Views/Shared/_Layout.cshtml";

    String dh0 = "Yêu cầu bảo hành";
    String dh1 = "Đang thực hiện bảo hành";
    String dh2 = "Bảo hành hành công";
}

<table class="table table-bordered container">
    <thead>
        <tr>
            <td colspan="5" style="text-align:center">Bill Detail</td>
        </tr>
        <tr>
            <th>
                Phone Name
            </th>
            <th>
                Price
            </th>
            <th>
                Status
            </th>
        </tr>

    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            FPhoneDbContext context = new FPhoneDbContext();
            var bh = context.WarrantyCards.FirstOrDefault(p => p.IdBillDetail == item.Id);
            <tr>
                <td>
                    @item.PhoneDetaild.Phones.PhoneName |
                    @item.PhoneDetaild.Rams.Name/@item.PhoneDetaild.Roms.Name |
                    @item.PhoneDetaild.Colors.Name (#imei:@item.Imei)
                </td>
                <td>
                    @string.Format("{0:0,0}", item.Price) vnđ
                </td>
                <td>
                    @if(bh != null)
                    {
                        if (bh.Status == null)
                        {

                        }
                        else if (bh.Status == 0)
                        {
                            <p class="text-success"> @dh0 (Lý do: @bh.Description)</p>
                        }
                        else if (bh.Status == 1)
                        {
                            <p class="text-danger"> @dh1</p>
                        }
                        else if (bh.Status == 2)
                        {
                            <p class="text-danger"> @dh2</p>
                        }
                    }
                    else
                    {
                        var bill = context.Bill.FirstOrDefault(p => p.Id == item.IdBill);
                        String dh10 = "Đã xác nhận";
                        String dh11 = "Chờ xác nhận";
                        String dh12 = "Đang giao";
                        String dh13 = "Đã giao";
                        String dh14 = "Đã hủy";
                        @if (bill.Status == 1)
                        {
                            <p class="text-success"> @dh10</p>
                        }
                        else if (bill.Status == 2)
                        {
                            <p class="text-danger"> @dh11</p>
                        }
                        else if (bill.Status == 3)
                        {
                            <p class="text-danger"> @dh12</p>
                        }
                        else if (bill.Status == 4)
                        {
                            <p class="text-success"> @dh13</p>
                        }
                        else if (bill.Status == 5)
                        {
                            <p class="text-success"> @dh14</p>
                        }
                    }

                </td>
                @* trường hợp đơn hàng giao thành công mới hiển thị Hoàn trả/Bảo hành*@
                @if(bh != null)
                {
                    if(bh.Status == null)
                    {
                        <td>
                            @Html.ActionLink("Bảo hành", "ThongTinBaoHanh", new {  idBill =item.IdBill })
                        </td>
                    }
                }
                
            </tr>
        }
    </tbody>
</table>

